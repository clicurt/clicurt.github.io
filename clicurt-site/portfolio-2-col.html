<!DOCTYPE html>
<html lang="en">

<head>


</head>

<body>
<div><xmp>
<?php
class Controller_Posts extends Controller_Template
{
	public function action_index()
	{
		$posts = Model_Post::find('all');
		
		$data = array('posts' => $posts);
      $this->template->title = 'Blog Posts';
      $this->template->content = View::forge('posts/index', $data, false);
	}
	
	public function action_add()
	{
		 if(Input::post('send')){
		 	$post = new Model_Post();
		 	$post->title = Input::post('title');
		 	$post->category = Input::post('category');
		 	$post->body = Input::post('body');
		 	$post->tags = Input::post('tags');
		 	$post->create_date = date('Y-m-d H:i:s');
		 	
		 	$post->save();
		 	
		 	Session::set_flash('success', 'Post Added');
		 	
		 	Response::redirect('/');
		 }
		 $data = array();
       $this->template->title = 'Add Posts';
       $this->template->content = View::forge('posts/add', $data);
	}
	
	public function action_view($id)
	{
		 $post = Model_Post::find('first', array(
		 	'where' => array(
		 		'id' => $id
		 	)
		 ));
		 
		 $data = array('post' => $post);
       $this->template->title = $post->title;
       $this->template->content = View::forge('posts/view', $data, false);
	}
	
	public function action_edit($id)
	{
		 
		  if(Input::post('send')){
		 	$post = Model_Post::find(Input::post('post_id'));
		 	$post->title = Input::post('title');
		 	$post->category = Input::post('category');
		 	$post->body = Input::post('body');
		 	$post->tags = Input::post('tags');
		 	$post->create_date = date('Y-m-d H:i:s');
		 	
		 	$post->save();
		 	
		 	Session::set_flash('success', 'Post Updated');
		 	
		 	Response::redirect('/');
		 }
		 
		 $post = Model_Post::find('first', array(
		 	'where' => array(
		 		'id' => $id
		 	)
		 ));
		 
		 $data = array('post' => $post);
       $this->template->title = 'Edit Post';
       $this->template->content = View::forge('posts/edit', $data, false);
	}
	
		public function action_delete($id)
	   {
		 $post = Model_Post::find($id);
		 $post->delete();
		 
		 Session::set_flash('success', 'Post Deleted');
		 	
		 Response::redirect('/');
	   }
	   
	   public function action_calendar()
	   {
		 //$post = Model_Post::find('all');
		 return View::forge('posts/calendar');
		 //$data = array('post' => $post);
      // $this->template->title = 'Calendar';
      // $this->template->content = View::forge('posts/calendar');
	}
	
}
</xmp></div>
<div>
<xmp>
Model
<?php
class Model_Post extends orm\Model{
	protected static $_properties = array(
		'id',
		'title',
		'category',
		'body',
		'tags',
		'create_date'
	);
}


<h1>index.php</h1>
<?php foreach($posts as $post) : ?>
<div class="blog-post">
   <h2 class="blog-post-title"><?php echo $post->title; ?></h2>
   <p class="blog-post-meta"><?php echo $post->create_date; ?></p>
   


   <?php echo Str::truncate($post->body, 200); ?><br/>
   <a class="btn btn-default" href="/posts/view/<?php echo $post->id; ?>">View more</a>
</div><!-- /.blog-post -->
<?php endforeach; ?>     


edit.php

<?php echo Form::open('posts/edit/<?php echo $post->id; ?>'); ?>
<div class="form-group">
	<?php echo Form::label('Title', 'title'); ?>
	<?php echo Form::input('title', Input::post('title', isset($post) ? $post->title : ''), array('class' => 'form-control')); ?>
</div>

<div class="form-group">
	<?php echo Form::label('Category', 'category'); ?>
	<?php echo Form::select('category', $post->category, array(
		'0' => 'select Category',
		'Web Design' => 'Web Design',
		'Programming' => 'Programming',
		'Graphic Design' => 'Graphic Design'
	), array('class' => 'form-control')); ?>
</div>

<div class="form-group">
	<?php echo Form::label('Body', 'body'); ?>
	<?php echo Form::textarea('body', Input::post('body', isset($post) ? $post->body : ''), array('class' => 'form-control')); ?>
</div>

<div class="form-group">
	<?php echo Form::label('Tags', 'tags'); ?>
	<?php echo Form::input('tags', Input::post('tags', isset($post) ? $post->tags : ''), array('class' => 'form-control')); ?>
</div>

<input type="hidden" name="post_id" value="<?php echo $post->id; ?>">

<div class="actions">
<?php echo Form::submit('send'); ?>
	
</div>

<?php echo Form::close(); ?>




<h1>add.php</h1>

<?php echo Form::open('posts/add'); ?>
<div class="form-group">
	<?php echo Form::label('Title', 'title'); ?>
	<?php echo Form::input('title', Input::post('title', isset($post) ? $post->title : ''), array('class' => 'form-control')); ?>
</div>

<div class="form-group">
	<?php echo Form::label('Category', 'category'); ?>
	<?php echo Form::select('category', '0', array(
		'0' => 'select Category',
		'Web Design' => 'Web Design',
		'Programming' => 'Programming',
		'Graphic Design' => 'Graphic Design'
	), array('class' => 'form-control')); ?>
</div>

<div class="form-group">
	<?php echo Form::label('Body', 'body'); ?>
	<?php echo Form::textarea('body', Input::post('body', isset($post) ? $post->body : ''), array('class' => 'form-control')); ?>
</div>

<div class="form-group">
	<?php echo Form::label('Tags', 'tags'); ?>
	<?php echo Form::input('tags', Input::post('tags', isset($post) ? $post->tags : ''), array('class' => 'form-control')); ?>
</div>

<div class="actions">
<?php echo Form::submit('send'); ?>
	
</div>

<?php echo Form::close(); ?>





<h1>Comments </h1>

<?php echo Form::open('comments/index/<?php echo $comments->id; ?>'); ?>
<?php foreach($comments as $comment) : ?>
<?php $array[] = $comment->title; ?>
<?php endforeach; ?> 
<div class="form-group">
	<?php echo Form::label('Category', 'category'); ?>
	<?php echo Form::select('category', $comment->title, array(
		'0' => 'select Category',
		'title' => $array
	), array('class' => 'form-control')); ?>
</div>

<?php echo Form::submit('send'); ?>

<input type="hidden" name="comment_id" value="<?php echo $comment->id; ?>">

<div class="actions">

	
</div>

<?php echo Form::close(); ?>



   
<?php
class Controller_Comments extends Controller_Template
{
	public function action_index()
	{
		$comments = Model_Post::find('all'); 
		
		$data = array('comments' => $comments,
		);
      $this->template->title = 'Blog Comments';
      $this->template->content = View::forge('comments/index', $data, false);
	}
}




<h1>view</h1>

<?php echo Form::open('comments/index/<?php echo $comments->id; ?>'); ?>
<?php foreach($comments as $comment) : ?>
<?php $array[] = $comment->title; ?>
<?php endforeach; ?> 
<div class="form-group">
	<?php echo Form::label('Category', 'category'); ?>
	<?php echo Form::select('category', $comment->title, array(
		'0' => 'select Category',
		'title' => $array
	), array('class' => 'form-control')); ?>
</div>

<?php echo Form::submit('send'); ?>

<input type="hidden" name="comment_id" value="<?php echo $comment->id; ?>">

<div class="actions">

	
</div>

<?php echo Form::close(); ?>


</xmp>
</div>


</body>


</html>
